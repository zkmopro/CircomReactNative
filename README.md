# Circom React Native

**CircomReactNative** is a React Native package for generating and verifying [Circom](https://github.com/iden3/circom) zero-knowledge proofs using the groth16 backend.

The Swift and Android bindings are generated by the [**mopro CLI**](https://zkmopro.org/docs/getting-started) using the **Circom adapter**, which utilizes [`circom-prover`](https://github.com/zkmopro/mopro/tree/main/circom-prover) with [`circom-witnesscalc`](https://github.com/iden3/circom-witnesscalc) for witness generation and [`arkworks`](https://github.com/arkworks-rs) for groth16 proof construction.

To learn more about the original Rust implementation before generating bindings, please refer to [zkmopro documentation](https://zkmopro.org/docs/getting-started).

> [!NOTE]  
> To use `circom-witnesscalc`, follow the [README instructions](https://github.com/iden3/circom-witnesscalc?tab=readme-ov-file#compile-a-circuit-and-build-the-witness-graph) to generate the **graph file** from your Circom circuits.
> Or the [script](https://github.com/semaphore-protocol/semaphore-rs/blob/ccf81861d4f10f196d3c705746003c54611fe784/script/build_witness_graph.sh#L38) from [`semaphore-rs`](https://github.com/semaphore-protocol/semaphore-rs)


## How to Import the Package

Use a Node.js package manager in your React Native app to install dependencies. For example:

```sh
# npm
npm install https://github.com/zkmopro/CircomReactNative
# yarn / pnpm
yarn add https://github.com/zkmopro/CircomReactNative
```

Alternatively, you can manually add it to your package.json:

```json
"dependencies": {
 "circom-react-native": "github:zkmopro/CircomReactNative",
}
```

## How to Use the Package

Here is an example of how to integrate and use this package.<br/>
For the full test implementation, see [example/App.tsx](example/App.tsx).

### Import the package
```ts
import CircomReactNative, {
  CircomProofLib,
  CircomProofResult,
  ProofLibOption,
} from "circom-react-native";
```

### Load graph and zkey

Please checkout [`circom`](https://docs.circom.io/getting-started/proving-circuits/#phase-2) and [`circom-witensscalc`](https://github.com/iden3/circom-witnesscalc?tab=readme-ov-file#compile-a-circuit-and-build-the-witness-graph) to see how to generate the zkey and the graph.

To load the circuit and graph in an Expo app, please checkout e.g. [`zkeyFilePath`](https://github.com/zkmopro/CircomReactNative/blob/5125766de72ac99774dea7f7ecdfdbc43b23736f/example/App.tsx#L43) to get the path. Then define the file path, e.g.


### `circomProve`

```ts
const circuitInputs = {
    a: [a],
    b: [b],
};

// Generate proof
const res: CircomProofResult =
    await CircomReactNative.circomProve(
        graphFilePath.replace("file://", ""),
        JSON.stringify(circuitInputs),
        zkeyFilePath.replace("file://", ""),
);
```

### `verifyCircomProof`

```ts
// Verify proof
const proofLib: CircomProofLib = {
    proofLib: ProofLibOption.Arkworks,
};
const isValid: boolean = await Circom.verifyCircomProof(
        zkeyFilePath.replace("file://", ""),
        res,
        proofLib,
);

console.log("Proof verification result:", isValid);
```

> [!WARNING]  
> The default bindings are built specifically for the `multiplier2` circom circuit. If you'd like to update the circuit or switch to a different proving scheme, please refer to the [How to Build the Package](#how-to-build-the-package) section.<br/>
> Circuit source code: https://github.com/zkmopro/circuit-registry/tree/main/multiplier2<br/>
> Example .zkey file for the circuit: http://ci-keys.zkmopro.org/multiplier2_final.zkey<br/>
> Example graph file for the circuit: https://github.com/zkmopro/mopro/raw/refs/heads/main/circom-prover/test-vectors/multiplier2.bin<br/>

<!-- 
TODO: documentation how to build the package
1. downgrade mopro-ffi to v0.3.1 (`=0.3.1`)
2. use the branch https://github.com/zkmopro/mopro/pull/664 -->

## Test the package

Use the example app folder:

```sh
cd example
```

1. Install the dependencies

```sh
npm install
```

2. Start the server

```sh
npm run start
```

3. Run the app on iOS

```sh
npm run ios
```

4. Run the app on Android

```sh
export ANDROID_HOME=~/Library/Android/sdk/
```

```sh
npm run android
```

> [!WARNING]
> If you are using Expo, run the app with:
> ```json
> "ios": "expo run:ios",
> "android": "expo run:android"
> ```
> These commands build and run the native iOS and Android projects. <br/>
> And make sure the Android `minSdkVersion` is set to 28.
> 


## Community

- X account: <a href="https://twitter.com/zkmopro"><img src="https://img.shields.io/twitter/follow/zkmopro?style=flat-square&logo=x&label=zkmopro"></a>
- Telegram group: <a href="https://t.me/zkmopro"><img src="https://img.shields.io/badge/telegram-@zkmopro-blue.svg?style=flat-square&logo=telegram"></a>

## Acknowledgements

This work was initially sponsored by a joint grant from [PSE](https://pse.dev/) and [0xPARC](https://0xparc.org/). It is currently incubated by PSE.

This project is heavily inspired by [ezkl-swift-package](https://github.com/zkonduit/ezkl-swift-package) and follows a similar approach for integrating native cryptographic libraries into Swift via a Swift Package.
